<!--
// Copyright (c) 2023 Sander van Vliet
// Licensed under Artistic License 2.0
// See LICENSE or https://choosealicense.com/licenses/artistic-2.0/
-->

<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:viewModels="using:RoadCaptain.App.RouteBuilder.ViewModels"
        xmlns:converters="clr-namespace:RoadCaptain.App.Shared.Converters;assembly=RoadCaptain.App.Shared"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:sharedControls="clr-namespace:RoadCaptain.App.Shared.Controls;assembly=RoadCaptain.App.Shared"
        xmlns:appConverters="clr-namespace:RoadCaptain.App.RouteBuilder.Converters"
        xmlns:map="clr-namespace:Codenizer.Avalonia.Map;assembly=Codenizer.Avalonia.Map"
        xmlns:views="clr-namespace:RoadCaptain.App.RouteBuilder.Views"
        mc:Ignorable="d"
        x:Class="RoadCaptain.App.RouteBuilder.Views.MainWindow"
        Icon="avares://RoadCaptain.App.Shared/icon.png"
        Title="{Binding Path=Model.WindowTitle}"
        Height="768" Width="1024"
        Activated="MainWindow_OnActivated"
        WindowState="Maximized"
        x:DataType="viewModels:MainWindowViewModel">
	<Design.DataContext>
		<viewModels:DesignTimeMainWindowViewModel />
	</Design.DataContext>
	<Window.Styles>
		<Style Selector="Button.toolbar">
			<Setter Property="Width" Value="40" />
			<Setter Property="Margin" Value="4,0,0,2" />
		</Style>
		<Style Selector="Button.toolbar:disabled">
			<Setter Property="Background" Value="DarkGray"/>
		</Style>
		<Style Selector="Button.world">
			<Setter Property="Background" Value="White" />
			<Setter Property="Cursor" Value="Hand" />
			<Setter Property="Height" Value="100" />
		</Style>
		<Style Selector="Button.world:pointerover">
			<Setter Property="Background" Value="{StaticResource ZwiftOrange}" />
		</Style>
		<Style Selector="map|Map">
			<Setter Property="Margin" Value="0,0,0,0" />
		</Style>
		<Style Selector="map|Map.narrowHeight">
			<Setter Property="Margin" Value="0,0,0,250" />
		</Style>
	</Window.Styles>
	<Window.Resources>
		<converters:BooleanConverter x:Key="BooleanConverter" />
		<converters:ValueToBooleanConverter x:Key="ValueToBooleanConverter" />
		<converters:BitmapConverter x:Key="BitmapConverter" />
		<converters:NullabilityConverter x:Key="NullabilityConverter" />
		<appConverters:RouteViewModelConverter x:Key="RouteViewModelConverter" />
	</Window.Resources>
	<DockPanel>
		<Grid
                            Background="{Binding Path=Model.StatusBarBackground,FallbackValue={x:Static Brushes.DodgerBlue}}"
                            DockPanel.Dock="Bottom"
                            Height="26"
                            VerticalAlignment="Center"
                            Margin="0,0,0,0">
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="*" />
				<ColumnDefinition Width="105" />
			</Grid.ColumnDefinitions>
			<TextBlock Margin="6,2,0,0"
                       Text="{Binding Path=Model.StatusBarText, FallbackValue=Ready,TargetNullValue=Ready}"
                       Foreground="{Binding Path=Model.StatusBarForeground,FallbackValue={x:Static Brushes.White}}" VerticalAlignment="Center" />
			<StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Right" IsEnabled="True">
				<TextBlock Text="Version:" Foreground="White" VerticalAlignment="Center" />
				<Button Content="{Binding Path=Version}" Margin="4,0,2,0" CommandParameter="{Binding Path=ChangelogUri}" Command="{Binding Path=OpenLinkCommand}" Classes="link" VerticalAlignment="Center" />
				<TextBlock Text="🔗" Margin="0,0,4,0" VerticalAlignment="Center" />
			</StackPanel>
		</Grid>
		<Grid Margin="0,2,2,0">
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="300" />
				<ColumnDefinition />
			</Grid.ColumnDefinitions>
			<Grid.RowDefinitions>
				<RowDefinition Height="34"/>
				<RowDefinition Height="*" />
			</Grid.RowDefinitions>

			<Panel IsVisible="{Binding Path=Route.ReadyToBuild}"
                  Grid.Row="1" Grid.Column="1"
                  VerticalAlignment="Stretch">
				<map:Map
					Name="ZwiftMap"
					Cursor="Hand"
					MapObjectSelected="ZwiftMap_OnMapObjectSelected"
					VerticalAlignment="Top"
					Classes.narrowHeight="{Binding Path=ShowElevationProfile}" />

				<sharedControls:ElevationProfile
					Height="250"
					VerticalAlignment="Bottom"
					HorizontalAlignment="Stretch"
					Segments="{Binding Path=Segments}"
					Route="{Binding Path=Route,Mode=OneWay,Converter={StaticResource RouteViewModelConverter}}"
					RiderPosition="{Binding Path=RiderPosition}"
					Markers="{Binding Path=Markers}"
					IsVisible="{Binding Path=ShowElevationProfile}"
					RenderMode="All"
            />
			</Panel>

			<Grid Grid.Row="0" Grid.RowSpan="2" Grid.Column="1"
                  IsVisible="{Binding Path=Route.ReadyToBuild,Converter={StaticResource BooleanConverter},ConverterParameter=invert}"
                  Margin="3,40,4,4">
				<Grid.RowDefinitions>
					<RowDefinition Height="30" />
					<RowDefinition Height="*" />
					<RowDefinition Height="30" />
					<RowDefinition Height="150" />
				</Grid.RowDefinitions>
				<TextBlock Text="Select a world to build a route for:" FontSize="16" Grid.Row="0" />
				<ScrollViewer Grid.Row="1"  VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
					<ItemsControl Items="{Binding Path=Worlds}">
						<ItemsControl.ItemsPanel>
							<ItemsPanelTemplate>
								<WrapPanel />
							</ItemsPanelTemplate>
						</ItemsControl.ItemsPanel>
						<ItemsControl.ItemTemplate>
							<DataTemplate DataType="{x:Type viewModels:WorldViewModel}">
								<Button Classes="world" Command="{Binding Path=ViewModel.SelectWorldCommand,RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}}" CommandParameter="{Binding}" Cursor="Hand">
									<Button.Template>
										<ControlTemplate>
											<Border Name="borderZero" Background="White" CornerRadius="5" BorderThickness="2"
													Width="180" Height="100" Margin="8,8,8,8"
													Classes.isSelected="{Binding Path=IsSelected}">
												<Border.Styles>
													<Style Selector="Border">
														<Setter Property="BorderBrush" Value="#1192CC" />
													</Style>
													<Style Selector="Border:pointerover">
														<Setter Property="BorderBrush" Value="{StaticResource ZwiftOrange}"/>
													</Style>
													<Style Selector="Border.isSelected">
														<Setter Property="BorderBrush" Value="{StaticResource ZwiftOrange}"/>
													</Style>
												</Border.Styles>
												<Grid>
													<Image Source="{Binding Path=Image,Converter={StaticResource BitmapConverter}}" Height="100" Stretch="Uniform" ClipToBounds="True" Margin="0"
														   Classes.isSelected="{Binding Path=IsSelected}"
                                                           Classes.notAvailable="{Binding Path=CanSelect, Converter={StaticResource BooleanConverter}, ConverterParameter=invert}">
														<Image.Styles>
															<Style Selector="Image">
																<Setter Property="Opacity" Value="0.7" />
															</Style>
															<Style Selector="Image.notAvailable">
																<Setter Property="Opacity" Value="0.2" />
                                                            </Style>
															<Style Selector="Image:pointerover">
																<Setter Property="Opacity" Value="1"/>
															</Style>
															<Style Selector="Image.isSelected">
																<Setter Property="Opacity" Value="1"/>
															</Style>
														</Image.Styles>
													</Image>
													<Border Margin="0" Height="24" VerticalAlignment="Top" HorizontalAlignment="Right" BorderThickness="1,0,0,1" CornerRadius="0,5,0,5" Background="White"
                                                            Classes.notAvailable="{Binding Path=CanSelect, Converter={StaticResource BooleanConverter}, ConverterParameter=invert}">
														<Border.Styles>
															<Style Selector="Border">
                                                                <Setter Property="BorderBrush" Value="{StaticResource ZwiftOrange}"/>
                                                            </Style>
															<Style Selector="Border.notAvailable">
																<Setter Property="BorderBrush" Value="Gray" />
                                                            </Style>
                                                        </Border.Styles>
                                                        <TextBlock Text="{Binding Path=Name}" FontWeight="Bold" FontSize="16" Padding="4,2,4,0" 
                                                                   Classes.notAvailable="{Binding Path=CanSelect, Converter={StaticResource BooleanConverter}, ConverterParameter=invert}">
															<TextBlock.Styles>
																<Style Selector="TextBlock">
																	<Setter Property="Foreground" Value="Black" />
                                                                </Style>
                                                                <Style Selector="TextBlock.notAvailable">
																	<Setter Property="Foreground" Value="Gray"/>
                                                                </Style>
                                                            </TextBlock.Styles>
                                                        </TextBlock>
													</Border>
													<Border Margin="0" Height="24" VerticalAlignment="Bottom" HorizontalAlignment="Left" BorderBrush="{StaticResource ZwiftOrange}" BorderThickness="0,1,1,0" CornerRadius="0,5,0,5" Background="White"
                                                            IsVisible="{Binding Path=IsBeta}">
														<TextBlock Text="BETA" FontWeight="Bold" FontSize="16" Foreground="Black" Padding="4,2,4,0"  />
													</Border>
												</Grid>
											</Border>
										</ControlTemplate>
									</Button.Template>
								</Button>
							</DataTemplate>
						</ItemsControl.ItemTemplate>
					</ItemsControl>
				</ScrollViewer>

				<StackPanel Orientation="Horizontal" Grid.Row="2">
					<TextBlock Text="Select a sport to build a route for:" FontSize="16" VerticalAlignment="Center" />
					<Button Content="(reset default)" Classes="link" Foreground="Blue" VerticalAlignment="Center"
                            IsVisible="{Binding Path=HasDefaultSport}"
                            Command="{Binding Path=ResetDefaultSportCommand}"/>
				</StackPanel>
				<ScrollViewer Grid.Row="3" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
					<ItemsControl Items="{Binding Path=Sports}">
						<ItemsControl.ItemsPanel>
							<ItemsPanelTemplate>
								<WrapPanel />
							</ItemsPanelTemplate>
						</ItemsControl.ItemsPanel>
						<ItemsControl.ItemTemplate>
							<DataTemplate DataType="{x:Type viewModels:SportViewModel}">
								<Button Classes="world" Command="{Binding Path=ViewModel.SelectSportCommand,RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}}" CommandParameter="{Binding}" Cursor="Hand">
									<Button.Template>
										<ControlTemplate>
											<Border Name="borderZero" Background="White" CornerRadius="5" BorderThickness="2"
													Width="180" Height="100" Margin="8,8,8,8"
													Classes.isSelected="{Binding Path=IsSelected}">
												<Border.Styles>
													<Style Selector="Border">
														<Setter Property="BorderBrush" Value="{StaticResource ZwiftBlue}" />
													</Style>
													<Style Selector="Border:pointerover">
														<Setter Property="BorderBrush" Value="{StaticResource ZwiftOrange}"/>
													</Style>
													<Style Selector="Border.isSelected">
														<Setter Property="BorderBrush" Value="{StaticResource ZwiftOrange}"/>
													</Style>
												</Border.Styles>
												<Grid>
													<Image Source="{Binding Path=Image}" Height="100" Stretch="Uniform" ClipToBounds="True" Margin="0"
														   Classes.isSelected="{Binding Path=IsSelected}">
														<Image.Styles>
															<Style Selector="Image">
																<Setter Property="Opacity" Value="0.5" />
															</Style>
															<Style Selector="Image:pointerover">
																<Setter Property="Opacity" Value="1"/>
															</Style>
															<Style Selector="Image.isSelected">
																<Setter Property="Opacity" Value="1"/>
															</Style>
														</Image.Styles>
													</Image>
													<Border Margin="0" Height="28" VerticalAlignment="Top" HorizontalAlignment="Right" BorderBrush="{StaticResource ZwiftOrange}" BorderThickness="1,0,0,1" CornerRadius="0,5,0,5" Background="White"
                                                            IsVisible="{Binding Path=IsDefault}">
														<TextBlock Text="Default" FontSize="16" Foreground="Black" Padding="4,2,4,0"  />
													</Border>
												</Grid>
											</Border>
										</ControlTemplate>
									</Button.Template>
								</Button>
							</DataTemplate>
						</ItemsControl.ItemTemplate>
					</ItemsControl>
				</ScrollViewer>
			</Grid>

			<WrapPanel Grid.Row="0" Grid.Column="1"
                        VerticalAlignment="Top"
                        HorizontalAlignment="Left"
                        Orientation="Horizontal"
                        Background="White"
                        Margin="4,0,0,0">
				<Button Command="{Binding Path=SimulateCommand}" Cursor="Hand"
                        Classes="toolbar"
                        Classes.simulationRunning="{Binding Path=SimulationState,Converter={StaticResource ValueToBooleanConverter},ConverterParameter=Running}">
					<Button.Styles>
						<Style Selector="Button">
							<Setter Property="Content" Value="▶️" />
						</Style>
						<Style Selector="Button.simulationRunning">
							<Setter Property="Content" Value="⏸️" />
						</Style>
					</Button.Styles>
				</Button>
				<Button Content="🚮" Command="{Binding Path=ClearRouteCommand}" ToolTip.Tip="Clear route" Classes="toolbar" />
				<Button Content="🌐" Command="{Binding Path=ResetWorldCommand}" ToolTip.Tip="Select world and sport" Classes="toolbar" />
				<Button Content="💾" Command="{Binding Path=SaveRouteCommand}" ToolTip.Tip="Save route" Classes="toolbar" />
				<Button Content="📂" Command="{Binding Path=OpenRouteCommand}" ToolTip.Tip="Open route" Classes="toolbar" />
				<Button Content="⭯" Command="{Binding Path=RemoveLastSegmentCommand}" ToolTip.Tip="Remove last segment" Classes="toolbar"/>
				<StackPanel Orientation="Horizontal">
					<CheckBox Content="Show KOMs" VerticalAlignment="Center" Margin="8,0,0,0" IsChecked="{Binding Path=ShowClimbs}" ToolTip.Tip="Show the KOM start (red) and finish (green) markers on the map" IsVisible="{Binding Path=Route.ReadyToBuild}" />
					<CheckBox Content="Show Sprints" VerticalAlignment="Center" Margin="8,0,0,0" IsChecked="{Binding Path=ShowSprints}" ToolTip.Tip="Show the sprint segments on the map" IsVisible="{Binding Path=Route.ReadyToBuild}" />
					<CheckBox Content="Show elevation profile" VerticalAlignment="Center" Margin="8,0,0,0" IsChecked="{Binding Path=ShowElevationProfile}" ToolTip.Tip="Show the elevation profile for the current route" IsVisible="{Binding Path=Route.ReadyToBuild}" />
				</StackPanel>
				<StackPanel Orientation="Horizontal">
					<Button Content="+" Click="ZoomIn_Click" ToolTip.Tip="Zoom in" IsEnabled="{Binding Path=Route.ReadyToBuild}" IsVisible="{Binding Path=Route.ReadyToBuild}" Classes="toolbar" />
					<Button Content="-" Click="ZoomOut_Click" ToolTip.Tip="Zoom out" IsEnabled="{Binding Path=Route.ReadyToBuild}" IsVisible="{Binding Path=Route.ReadyToBuild}" Classes="toolbar" />
					<Button Click="ResetZoom_Click" ToolTip.Tip="Fit to screen" IsEnabled="{Binding Path=Route.ReadyToBuild}" IsVisible="{Binding Path=Route.ReadyToBuild}" Classes="toolbar">
                        <Image Source="../Assets/four-arrows-outward.png" Margin="2" />
					</Button>
					<Button Click="ZoomRoute_Click" ToolTip.Tip="Fit to route" IsEnabled="{Binding Path=Route.ReadyToBuild}" IsVisible="{Binding Path=Route.ReadyToBuild}" Classes="toolbar">
                        <Image Source="../Assets/four-arrows-inward.png" Margin="2" />
                    </Button>
				</StackPanel>
			</WrapPanel>

			<views:RouteSegmentListView Grid.Row="0" Grid.RowSpan="2" Grid.Column="0" Name="RouteSegmentListView" DataContext="{Binding}" />
		</Grid>
	</DockPanel>

</Window>
